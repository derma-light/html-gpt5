/**
 * Card Expandable Component - Minified Version
 * SPEC v1.1 Card Expandable v1.4
 */
(function(){"use strict";let motionDurationCache=null;let motionDurationMsCache=null;const getMotionDuration=()=>{if(motionDurationCache===null){const prefersReducedMotion=window.matchMedia("(prefers-reduced-motion: reduce)").matches;const root=document.documentElement;if(prefersReducedMotion){motionDurationCache=getComputedStyle(root).getPropertyValue("--motion-duration-collapse-reduced")||"0ms"}else{motionDurationCache=getComputedStyle(root).getPropertyValue("--motion-duration-collapse")||"200ms"}}return motionDurationCache};const getDurationMs=()=>{if(motionDurationMsCache===null){const duration=getMotionDuration();motionDurationMsCache=parseInt(duration)||200}return motionDurationMsCache};const expandableCards=new Map();function init(root=document){const cards=(root===document?document:root).querySelectorAll(".card--expandable[data-expandable]");cards.forEach((card,index)=>{if(expandableCards.has(card))return;const toggle=card.querySelector(".card__toggle");const panel=card.querySelector(".card__content");if(!toggle||!panel)return;const toggleId=toggle.id||`card-toggle-${Date.now()}-${index}`;const panelId=panel.id||`card-panel-${Date.now()}-${index}`;toggle.id=toggleId;panel.id=panelId;toggle.setAttribute("aria-controls",panelId);panel.setAttribute("aria-labelledby",toggleId);panel.setAttribute("role","region");expandableCards.set(card,{toggle,panel,isOpen:card.hasAttribute("data-expanded")||card.classList.contains("is-open")});if(!expandableCards.get(card).isOpen){collapse(card,false)}toggle.addEventListener("click",()=>toggleCard(card));toggle.addEventListener("keydown",(e)=>handleKeydown(e,card))});initAccordionGroups(root)}function toggle(card){const cardElement=resolveCard(card);if(!cardElement)return Promise.resolve();const cardData=expandableCards.get(cardElement);if(!cardData)return Promise.resolve();if(cardData.isOpen){return collapse(cardElement)}else{return expand(cardElement)}}function expand(card){const cardElement=resolveCard(card);if(!cardElement)return Promise.resolve();const cardData=expandableCards.get(cardElement);if(!cardData||cardData.isOpen)return Promise.resolve();const{toggle,panel}=cardData;dispatchEvent("card:expand-start",{card:cardElement,panel,toggle});const targetHeight=panel.scrollHeight;panel.style.height="0px";panel.style.visibility="visible";panel.style.pointerEvents="auto";requestAnimationFrame(()=>{panel.offsetHeight;panel.style.height=`${targetHeight}px`});toggle.setAttribute("aria-expanded","true");cardElement.classList.add("is-open");panel.removeAttribute("aria-hidden");updateDynamicLabels(toggle,true);cardData.isOpen=true;return new Promise((resolve)=>{setTimeout(()=>{panel.style.height="auto";dispatchEvent("card:expand-end",{card:cardElement,panel,toggle});resolve()},getDurationMs())})}function collapse(card,animate=true){const cardElement=resolveCard(card);if(!cardElement)return Promise.resolve();const cardData=expandableCards.get(cardElement);if(!cardData||!cardData.isOpen)return Promise.resolve();const{toggle,panel}=cardData;dispatchEvent("card:collapse-start",{card:cardElement,panel,toggle});return new Promise((resolve)=>{if(animate&&!window.matchMedia("(prefers-reduced-motion: reduce)").matches){const currentHeight=panel.scrollHeight;panel.style.height=`${currentHeight}px`;requestAnimationFrame(()=>{panel.offsetHeight;panel.style.height="0px"});setTimeout(()=>{panel.style.visibility="hidden";panel.style.pointerEvents="none";panel.setAttribute("aria-hidden","true");toggle.setAttribute("aria-expanded","false");cardElement.classList.remove("is-open");updateDynamicLabels(toggle,false);cardData.isOpen=false;dispatchEvent("card:collapse-end",{card:cardElement,panel,toggle});resolve()},getDurationMs())}else{panel.style.height="0px";panel.style.visibility="hidden";panel.style.pointerEvents="none";panel.setAttribute("aria-hidden","true");toggle.setAttribute("aria-expanded","false");cardElement.classList.remove("is-open");updateDynamicLabels(toggle,false);cardData.isOpen=false;dispatchEvent("card:collapse-end",{card:cardElement,panel,toggle});resolve()}})}function resolveCard(card){if(!card)return null;if(typeof card==="string"){if(card.startsWith("#")){return document.getElementById(card.slice(1))}if(/^[a-zA-Z][\w-]*$/.test(card)){return document.getElementById(card)}return document.querySelector(card)}if(card instanceof Element){return card}return null}function updateDynamicLabels(toggle,isOpen){const dynLabel=toggle.querySelector(".card__toggle-dyn");if(!dynLabel)return;const openLabel=toggle.getAttribute("data-label-open");const closedLabel=toggle.getAttribute("data-label-closed");if(openLabel&&closedLabel){dynLabel.textContent=isOpen?openLabel:closedLabel}}function handleKeydown(event,card){const{key}=event;if(key==="Enter"||key===" "){event.preventDefault();toggle(card);return}const group=card.closest("[data-accordion-group]");if(!group)return;const cards=Array.from(group.querySelectorAll(".card--expandable[data-expandable]"));const currentIndex=cards.indexOf(card);let nextCard=null;switch(key){case"ArrowDown":event.preventDefault();nextCard=cards[(currentIndex+1)%cards.length];break;case"ArrowUp":event.preventDefault();nextCard=cards[currentIndex===0?cards.length-1:currentIndex-1];break;case"Home":event.preventDefault();nextCard=cards[0];break;case"End":event.preventDefault();nextCard=cards[cards.length-1];break}if(nextCard){const nextToggle=nextCard.querySelector(".card__toggle");if(nextToggle){nextToggle.focus()}}}function initAccordionGroups(root){const groups=(root===document?document:root).querySelectorAll("[data-accordion-group]");groups.forEach(group=>{group.addEventListener("keydown",(e)=>{const card=e.target.closest(".card--expandable[data-expandable]");if(card){handleKeydown(e,card)}})})}function dispatchEvent(type,detail){const event=new CustomEvent(type,{detail,bubbles:true,cancelable:true});document.dispatchEvent(event)}function handlePrint(){expandableCards.forEach((cardData,card)=>{if(!cardData.isOpen){const{panel}=cardData;panel.style.height="auto";panel.style.visibility="visible";panel.style.pointerEvents="auto";panel.removeAttribute("aria-hidden")}})}function handleAfterPrint(){expandableCards.forEach((cardData,card)=>{if(!cardData.isOpen){const{panel}=cardData;panel.style.height="0px";panel.style.visibility="hidden";panel.style.pointerEvents="none";panel.setAttribute("aria-hidden","true")}})}window.CardExpandable={init,expand,collapse,toggle};if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",()=>{document.documentElement.classList.replace("no-js","js");init()})}else{document.documentElement.classList.replace("no-js","js");init()}window.addEventListener("beforeprint",handlePrint);window.addEventListener("afterprint",handleAfterPrint)})();
